select
*
from ua_loyalty loy
inner join ua_individual ind on loy.indiv_id=ind.indiv_id
where loy.wedding_rewards_mem_flg = 'Y'
and ind.state_province_cd ='TX'
and ind.indiv_id in (select indiv_id from ua_email_ref where valid_email_mktg_flg='Y');

select
distinct
em.email_addr_txt
from ua_email em
inner join ua_email_ref rf on em.email_id=rf.email_id and rf.pref_indiv_em_flg='Y' and rf.valid_email_mktg_flg='Y'
where rf.indiv_id in ('1000285571010', '1000263974568', '1000301950522', '1000180646273', '1000316179667', '1000173873147', '1000225003839', '1000059259870', '1000313872951', '1000140965925', '1000088128609', '1000316389414', '1000183239028', '1000114666812', '1000085133854', '1000156149105', '1000064763938', '1000081020526', '1000317304000', '1000188988099', '1000294739691', '1000156560498', '1000094590114', '1000275171664', '1000308358918', '1000310891185', '1000054304504', '1000315724974', '1000255479939', '1000196880636', '1000133019733', '1000256206790', '1000312097620', '1000165666794', '1000306002790', '1000317594369', '1000177101782', '1000302918482', '1000136687434', '1000142279040', '1000316324070', '1000171502047', '1000304787023', '1000314641483', '1000303620743', '1000094519140', '1000180708794', '1000215079276', '1000300894066', '1000293719313', '1000312680070', '1000309451386', '1000301735946', '1000312724818', '1000032954197', '1000289395312', '1000063068625', '1000309823543', '1000272699050', '1000182637968', '1000274131742', '1000318561877', '1000247790577', '1000303975509', '1000269281308', '1000278107139', '1000287570986', '1000156111386', '1000264009633', '1000315516388', '1000241546050', '1000032630478', '1000177408969', '1000311272780', '1000162274931', '1000212982782', '1000184564353', '1000312437391', '1000191655988', '1000088526566', '1000275468431', '1000251781944', '1000065589410', '1000058158980', '1000146577099', '1000301986178', '1000313936474', '1000114052196', '1000285126321', '1000250507402', '1000302939047', '1000152658480', '1000035013441', '1000042339913', '1000055331952', '1000286940519', '1000039325259', '1000245680714', '1000080870363', '1000065967606', '1000067443797', '1000293686051', '1000089963412', '1000314725582', '1000032307029', '1000295646193', '1000289360689', '1000033229361', '1000303600329', '1000035953563', '1000077594962', '1000037944384', '1000309133044', '1000077654115', '1000309583705', '1000185393107', '1000307524355', '1000311722562', '1000034652400', '1000309422448', '1000191324621', '1000063260880', '1000303092699', '1000053531685', '1000267991398', '1000074372817', '1000081079977', '1000311064178', '1000160196073', '1000206970223', '1000316781836', '1000125979263', '1000070765571', '1000155710495', '1000313529538', '1000035400419', '1000311303236', '1000125135809', '1000229915342', '1000075882364', '1000151990721', '1000206288312', '1000060094859', '1000190600397', '1000087094722', '1000179981182', '1000055000322', '1000164857108', '1000037280529', '1000275656783', '1000317966219', '1000039209607', '1000311464959', '1000206972329', '1000309444086', '1000311814591', '1000043802173', '1000311222734', '1000284199075', '1000280346779', '1000309635371', '1000309208272', '1000316704234', '1000311155594', '1000161357495', '1000308443964', '1000202670794', '1000294713509', '1000310114238', '1000315865316', '1000317425261', '1000281733354', '1000315841611', '1000273818895', '1000121603196', '1000032791576', '1000300352483', '1000087228146', '1000300930832', '1000314655860', '1000170958885', '1000314469298', '1000310702964', '1000082077262', '1000208029189', '1000186627475', '1000127348407', '1000274379386', '1000247790559', '1000153832679', '1000040069379', '1000266787005', '1000064207984', '1000153391134', '1000237105123', '1000294748163', '1000038932101', '1000274071156', '1000166123210', '1000306937065', '1000311763570', '1000035973422', '1000035949392', '1000232944713', '1000214502458', '1000310737927', '1000272777989', '1000170649003', '1000308588910', '1000289011023', '1000224968157', '1000058378884', '1000303498024', '1000044101308', '1000282683066', '1000277515161', '1000264681437', '1000238124256', '1000170850775', '1000214903293', '1000293602966', '1000318442396', '1000043330080', '1000187011792', '1000282404855', '1000042976213', '1000284611218', '1000284611218', '1000284611218', '1000284611218', '1000284611218', '1000284611218', '1000284611218', '1000191982100', '1000278433223', '1000316550551', '1000232178557', '1000146269528', '1000313683620', '1000123219323', '1000314258489', '1000209477893', '1000177857569', '1000276069626', '1000254502108', '1000269707541')


select
distinct
em.email_addr_txt
from ua_individual ind
inner join ua_email_ref rf on rf.indiv_id=ind.indiv_id and rf.valid_email_mktg_flg='Y' and rf.pref_indiv_em_flg='Y'
inner join ua_email em on em.email_id=rf.email_id
and ind.indiv_id in ( select indiv_id 
from ua_pos_trans_dtl dtl
inner join ua_store str on dtl.loc_key = str.loc_key and str.loc_mkt_name='DALLAS/FT. WORTH, TX'
inner join ua_pos_prod_sku sku         on dtl.sku_key = sku.sku_key and sku.dept_idnt=25
where dtl.wk_idnt between 201829 and 201832);
